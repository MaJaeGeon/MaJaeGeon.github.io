{"componentChunkName":"component---src-templates-post-template-js","path":"/Csharp/2021-05-09-Google-Device-OAuth2.0-API-in-Csharp/","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"C#에서 Google Device OAuth2.0 API 사용하기\",\n  \"date\": \"2021-05-09\",\n  \"categories\": [\"Csharp\"],\n  \"notice\": false,\n  \"pinned\": false\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\uC774 \\uAE00\\uC5D0\\uC11C\\uB294 \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.google.com/identity/protocols/oauth2/limited-input-device\"\n  }, \"Google Device OAuth API\"), \"\\uB97C \\uD1B5\\uD574 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GoogleOAuthService\"), \"\\uB77C\\uB294 \\uC11C\\uBE44\\uC2A4\\uB97C \\uB9CC\\uB4E4\\uC5B4\\uBCF8\\uB2E4.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\uAE30\\uAE30 \\uC778\\uC99D \\uBC29\\uC2DD\\uC740 TV \\uAC19\\uC774 \\uC785\\uB825\\uC774 \\uC81C\\uD55C\\uB41C \\uD658\\uACBD\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294 \\uD504\\uB85C\\uADF8\\uB7A8\\uC744 \\uAC1C\\uBC1C\\uD560 \\uB54C \\uC0AC\\uC6A9\\uB41C\\uB2E4.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Device OAuth \\uC678\\uC5D0 \\uB2E4\\uB978 \\uC778\\uC99D \\uBC29\\uBC95\\uB4E4\\uC740 \\uC6F9\\uBE0C\\uB77C\\uC6B0\\uC800\\uB97C \\uD1B5\\uD574 \\uC778\\uC99D\\uC774 \\uC9C4\\uD589\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\uB9AC\\uB205\\uC2A4 CLI \\uD658\\uACBD\\uC758 \\uD504\\uB85C\\uADF8\\uB7A8\\uC744 \\uAC1C\\uBC1C\\uD558\\uB358 \\uB098\\uB294 \\uAE30\\uAE30 \\uC778\\uC99D \\uBC29\\uC2DD\\uC744 \\uC120\\uD0DD\\uD588\\uB2E4.  \"), mdx(\"br\", null), mdx(\"p\", null, \"Google OAuth API\\uB97C \\uC0AC\\uC6A9\\uD558\\uB824\\uBA74 \\uC0AC\\uC6A9\\uC790 \\uC778\\uC99D \\uC815\\uBCF4\\uAC00 \\uD544\\uC694\\uD55C\\uB370\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\uC774\\uAE00\\uC5D0\\uC11C\\uB294 \\uC0AC\\uC6A9\\uC790 \\uC778\\uC99D \\uC815\\uBCF4\\uB97C \\uC5BB\\uB294\\uAC83\\uC5D0 \\uB300\\uD574 \\uC124\\uBA85\\uD558\\uC9C0 \\uC54A\\uB294\\uB2E4.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\uC0AC\\uC6A9\\uC790 \\uC778\\uC99D \\uC815\\uBCF4\\uB97C \\uC5BB\\uB294 \\uBC29\\uBC95\\uC5D0 \\uB300\\uD574\\uC120 \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"../ETC/2021-05-08-Google-API-Credentials.md\"\n  }, \"Google \\uC0AC\\uC6A9\\uC790 \\uC778\\uC99D \\uC815\\uBCF4 \\uB9CC\\uB4E4\\uAE30\"), \"\\uBB38\\uC11C\\uB97C \\uBCF4\\uBA74\\uB41C\\uB2E4.\"), mdx(\"br\", null), mdx(\"h2\", {\n    \"id\": \"1-준비하기\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#1-%EC%A4%80%EB%B9%84%ED%95%98%EA%B8%B0\",\n    \"aria-label\": \"1 준비하기 permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"1. \\uC900\\uBE44\\uD558\\uAE30\"), mdx(\"p\", null, \"API\\uB97C \\uD638\\uCD9C\\uD560 \\uB54C HTTP \\uC694\\uCCAD\\uC744 \\uBCF4\\uB0B4\\uC57C\\uD558\\uAE30\\uB54C\\uBB38\\uC5D0 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"HttpRequestService\"), \" \\uB97C \\uB9CC\\uB4E4\\uC5B4\\uC900\\uB2E4.\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"cs\",\n    \"terminal\": \"carbon\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"public static class HttpRequestService\\n{\\n    public static string HttpRequest(string url, string data, WebHeaderCollection headers = null, string contextType = \\\"application/x-www-form-urlencoded\\\")\\n    {\\n        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);\\n        request.Method = WebRequestMethods.Http.Get;\\n        request.ContentType = contextType;\\n\\n        if (headers != null) request.Headers = headers;\\n\\n        if (!string.IsNullOrEmpty(data))\\n        {\\n            request.Method = WebRequestMethods.Http.Post;\\n\\n            byte[] bytes = Encoding.UTF8.GetBytes(data);\\n            request.ContentLength = bytes.Length;\\n\\n            using (Stream reqStream = request.GetRequestStream())\\n            {\\n                reqStream.Write(bytes, 0, bytes.Length);\\n            }\\n        }\\n\\n        string responseText = string.Empty;\\n\\n        try\\n        {\\n            using (HttpWebResponse resp = (HttpWebResponse)request.GetResponse())\\n            {\\n                Stream respStream = resp.GetResponseStream();\\n                using (StreamReader sr = new StreamReader(respStream))\\n                {\\n                    responseText = sr.ReadToEnd();\\n                }\\n            }\\n        }\\n        catch (WebException ex)\\n        {\\n            using (var stream = ex.Response.GetResponseStream())\\n            using (var reader = new StreamReader(stream))\\n            {\\n                responseText = reader.ReadToEnd();\\n            }\\n        }\\n        catch (Exception ex)\\n        {\\n            responseText = ex.Message;\\n        }\\n\\n        return responseText;\\n    }\\n}\"), \"\\n        \"), mdx(\"br\", null), mdx(\"p\", null, \"API\\uC758 \\uC694\\uCCAD\\uC5D0 \\uB300\\uD55C \\uC751\\uB2F5\\uAC12\\uC740 Json \\uD615\\uD0DC\\uB85C \\uBCF4\\uB0B4\\uC9C4\\uB2E4.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\uC6B0\\uB9AC\\uB294 Json\\uAC12\\uC744 \\uCC98\\uB9AC\\uD558\\uAE30\\uC704\\uD574 NuGet\\uC5D0\\uC11C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Newtonsoft.Json\"), \"\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4.\\n\", mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"785px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/8c34a08e7c2e66f713c930f62dda44b7/cda19/NuGet-Newtonsoft-Json.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"43.333333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABpklEQVQoz3WS227aQBBA+QUqVUowFGzj2158ZzG2wbgmaavmof//M6fypiSKlD4czezDnJ2Z3YW/D7hc9ozjjnH0GK87himjmX6RZwV5XmKanvzQI3WGVpowjHh8XOE46zdWK8fGRRBEGBNwajyORx9jXEwjKI5npExRKqeqjuSmZ7P1EEIgpeLh4dFKZvFdNsfF7fZM147UdY/WNVJWKFmiVYZOC8rSMAxP/Pzxwt7zieMYpTRRFCMSgRAK13XfO5yFTdMyDN+Z8+t1omk66vpoMaZlHJ95+f0HL9ZEsbCyubP1emP5MPJcPMuqypBlJXle2XhnPhdFTVnUbANhhWma4bn+v/1t3sQzC2MazufBFqVp8V+0zpFCopSiKOeLcrvPOEnwXO+9w2l6YhwnK7x38yl5xT5OCUKJFDlJkrLdBqxWWxznmxXaR5l31vcDp1NH111o27PldOppTh1t27/mTUuUaNJsRxJ/xfeXBMGSMPyC72/w/QDf37OY91eWB/tFDofmdTSZfkCpDCk1IjvQdi63yaHvV1yGDcYsiSKHMEyIooi/oWkSd4BbvIYAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Nuget-Newtonsoft.Json\",\n    \"title\": \"Nuget-Newtonsoft.Json\",\n    \"src\": \"/static/8c34a08e7c2e66f713c930f62dda44b7/cda19/NuGet-Newtonsoft-Json.png\",\n    \"srcSet\": [\"/static/8c34a08e7c2e66f713c930f62dda44b7/5a46d/NuGet-Newtonsoft-Json.png 300w\", \"/static/8c34a08e7c2e66f713c930f62dda44b7/0a47e/NuGet-Newtonsoft-Json.png 600w\", \"/static/8c34a08e7c2e66f713c930f62dda44b7/cda19/NuGet-Newtonsoft-Json.png 785w\"],\n    \"sizes\": \"(max-width: 785px) 100vw, 785px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"br\", null), mdx(\"p\", null, \"\\uC774\\uC81C GoogleOAuthService\\uB97C \\uB9CC\\uB4E4\\uAE30 \\uC704\\uD55C \\uAE30\\uBCF8\\uC801\\uC778 \\uC900\\uBE44\\uB294 \\uB05D\\uB0AC\\uB2E4.\"), mdx(\"br\", null), mdx(\"h2\", {\n    \"id\": \"2-google-device-oauth20-service-전체-소스코드\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#2-google-device-oauth20-service-%EC%A0%84%EC%B2%B4-%EC%86%8C%EC%8A%A4%EC%BD%94%EB%93%9C\",\n    \"aria-label\": \"2 google device oauth20 service 전체 소스코드 permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"2. Google Device OAuth2.0 Service \\uC804\\uCCB4 \\uC18C\\uC2A4\\uCF54\\uB4DC\"), mdx(\"p\", null, \"\\uC544\\uB798\\uC758 \\uB0B4\\uC6A9\\uC740 Google Device OAuth \\uBB38\\uC11C\\uB97C \\uB530\\uB77C C#\\uC73C\\uB85C \\uAD6C\\uD604\\uD55C\\uAC83\\uC774\\uB2E4.\"), mdx(\"br\", null), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"cs\",\n    \"terminal\": \"carbon\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"public class GoogleOAuthService\\n{\\n    private class AuthResponse\\n    {\\n        public string Device_Code { get; set; }\\n        public string User_Code { get; set; }\\n        public string Verification_Url { get; set; }\\n        public int Expires_In { get; set; }\\n        public int Interval { get; set; }\\n    }\\n\\n    public class Token\\n    {\\n        public string Access_Token { get; set; }\\n        public string Refresh_Token { get; set; }\\n        public string Token_Type { get; set; }\\n        public string Scope { get; set; }\\n        public int Expires_In { get; set; }\\n    }\\n\\n\\n    const string OauthBase = \\\"https://oauth2.googleapis.com\\\";\\n\\n    private readonly string _clientId;\\n    private readonly string _clientSecret;\\n\\n    public Token CurrentToken { get; set; }\\n\\n\\n    public GoogleOAuthService(string clientId, string clientSecret)\\n    {\\n        _clientId = clientId;\\n        _clientSecret = clientSecret;\\n    }\\n\\n    public void DeviceOAuth()\\n    {\\n        // RefreshToken \\uC774 \\uC874\\uC7AC\\uD558\\uBA74 \\uAE30\\uAE30\\uC778\\uC99D\\uC744 \\uD558\\uC9C0\\uC54A\\uACE0 \\uC0C8 \\uD1A0\\uD070\\uC744 \\uBC1B\\uC544\\uC628\\uB2E4.\\n        if (File.Exists($\\\"{Directory.GetCurrentDirectory()}\\\\\\\\RefreshToken\\\"))\\n        {\\n            RefreshToken();\\n\\n            return;\\n        }\\n\\n        // RefreshToken \\uC774 \\uC800\\uC7A5\\uB418\\uC5B4 \\uC788\\uC9C0 \\uC54A\\uC744 \\uB54C.\\n        string data = $\\\"client_id={_clientId}&scope=https://www.googleapis.com/auth/youtube\\\";\\n\\n        var authResp = JsonConvert.DeserializeObject<AuthResponse>(HttpRequestService.HttpRequest($\\\"{OauthBase}/device/code\\\", data));\\n\\n        Console.WriteLine($\\\"Verification Url : {authResp.Verification_Url}\\\\nUser Code : {authResp.User_Code}\\\");\\n\\n        CurrentToken = AuthPolling(authResp);\\n\\n        File.WriteAllText($\\\"{Directory.GetCurrentDirectory()}\\\\\\\\RefreshToken\\\", CurrentToken.Refresh_Token);\\n    }\\n\\n    public void RefreshToken()\\n    {\\n        string data = $\\\"client_id={_clientId}&client_secret={_clientSecret}&refresh_token={File.ReadAllText($\\\"{Directory.GetCurrentDirectory()}\\\\\\\\RefreshToken\\\")}&grant_type=refresh_token\\\";\\n\\n        var pollingResp = HttpRequestService.HttpRequest($\\\"{OauthBase}/token\\\", data);\\n\\n        if (pollingResp.Contains(\\\"error\\\")) return;\\n\\n        CurrentToken = JsonConvert.DeserializeObject<Token>(pollingResp);\\n    }\\n\\n    private Token AuthPolling(AuthResponse authResp)\\n    {\\n        while (true)\\n        {\\n            var tokenResp = RequestPolling(authResp);\\n\\n            if (tokenResp != null) return tokenResp;\\n\\n            Thread.Sleep(authResp.Interval * 1000);\\n        }\\n    }\\n\\n    private Token RequestPolling(AuthResponse authResp)\\n    {\\n        string data = $\\\"client_id={_clientId}&client_secret={_clientSecret}&device_code={authResp.Device_Code}&grant_type=urn:ietf:params:oauth:grant-type:device_code\\\";\\n\\n        var pollingResp = HttpRequestService.HttpRequest($\\\"{OauthBase}/token\\\", data);\\n\\n        if (pollingResp.Contains(\\\"error\\\")) return null;\\n\\n        return JsonConvert.DeserializeObject<Token>(pollingResp);\\n    }\\n}\"), \"\\n        \"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"이 글에서는  Google Device OAuth API 를 통해  GoogleOAuthService 라는 서비스를 만들어본다. 기기 인증 방식은 TV 같이 입력이 제한된 환경에서 사용하는 프로그램을 개발할 때 사용된다. Device OAuth…","tableOfContents":{"items":[{"url":"#1-준비하기","title":"1. 준비하기"},{"url":"#2-google-device-oauth20-service-전체-소스코드","title":"2. Google Device OAuth2.0 Service 전체 소스코드"}]},"frontmatter":{"categories":["Csharp"],"date":"2021-05-09","notice":false,"pinned":false,"title":"C#에서 Google Device OAuth2.0 API 사용하기"}}},"pageContext":{"id":"8650adf0-9ed3-5800-925d-0e2f3ea0555e"}},"staticQueryHashes":["1574624805","2826173664","2872546089"]}